"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const devkit_1 = require("@nx/devkit");
const utils_1 = require("../../utils");
/**
 * Add tidy executor to existing nx-go projects
 *
 * @param tree the project tree
 */
function update(tree) {
    var _a;
    return tslib_1.__awaiter(this, void 0, void 0, function* () {
        // When it's not a go workspace we don't add it to any project
        if (!(0, utils_1.isGoWorkspace)(tree)) {
            return;
        }
        const projects = (0, devkit_1.getProjects)(tree);
        for (const [projectName, projectConfig] of projects) {
            let shouldUpdate = false;
            if (!projectConfig.targets)
                continue;
            if (!(0, utils_1.isProjectUsingNxGo)(projectConfig))
                continue;
            if (!projectConfig.targets.tidy ||
                ((_a = projectConfig.targets.tidy) === null || _a === void 0 ? void 0 : _a.executor) !== '@nx-go/nx-go:tidy') {
                projectConfig.targets.tidy = {
                    executor: '@nx-go/nx-go:tidy',
                };
                shouldUpdate = true;
            }
            if (shouldUpdate) {
                (0, devkit_1.updateProjectConfiguration)(tree, projectName, projectConfig);
            }
        }
        yield (0, devkit_1.formatFiles)(tree);
    });
}
exports.default = update;
//# sourceMappingURL=add-tidy-target-to-libraries-and-applications.js.map